<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Physics Premier League</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Teko:wght@400;600&family=Roboto:wght@400;700&display=swap');
        
        body { font-family: 'Roboto', sans-serif; background: #e0f7fa; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        
        .stadium {
            background: linear-gradient(to bottom, #4fc3f7, #81c784);
            width: 100%; max-width: 450px; border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); overflow: hidden; position: relative;
            border: 5px solid #fff;
        }

        /* SCOREBOARD */
        .scoreboard {
            background: #263238; color: #fff; padding: 15px; display: flex; justify-content: space-between; align-items: center;
            font-family: 'Teko', sans-serif; font-size: 1.5em; border-bottom: 4px solid #fdd835;
        }
        .runs-box { color: #fdd835; font-size: 1.8em; }
        .wicket-box { color: #ff5252; }

        /* FIELD ACTION */
        .field {
            height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center;
            position: relative;
        }
        .batter { font-size: 5em; transition: transform 0.2s; cursor: pointer; }
        .ball { font-size: 2em; position: absolute; opacity: 0; transition: all 0.5s; }
        
        /* COMMENTARY BOX (Question) */
        .commentary-box {
            background: white; padding: 20px; text-align: center; border-radius: 20px 20px 0 0;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.1); min-height: 300px;
        }
        .commentary-text { color: #546e7a; font-weight: bold; margin-bottom: 10px; font-style: italic; }
        .question-text { font-size: 1.1em; color: #263238; margin-bottom: 20px; font-weight: bold; }

        /* BUTTONS */
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn {
            background: #eceff1; border: 2px solid #cfd8dc; padding: 15px; border-radius: 8px;
            font-weight: bold; cursor: pointer; color: #37474f; transition: 0.2s;
        }
        .btn:hover { background: #cfd8dc; transform: scale(1.02); }
        .btn.four { background: #4caf50; color: white; border-color: #2e7d32; }
        .btn.out { background: #f44336; color: white; border-color: #b71c1c; }

        /* ANIMATIONS */
        @keyframes hit6 { 0% { bottom: 50px; left: 50%; opacity: 1; transform: scale(1); } 100% { bottom: 300px; left: 100%; opacity: 0; transform: scale(0.5); } }
        .anim-six { animation: hit6 0.8s forwards; }
        
        @keyframes stumpOut { 0% { transform: rotate(0deg); } 20% { transform: rotate(-20deg); } 40% { transform: rotate(20deg); } 100% { transform: rotate(90deg) translateY(50px); opacity: 0; } }
        .anim-out { animation: stumpOut 0.8s forwards; }
    </style>
</head>
<body>

<div class="stadium">
    <div class="scoreboard">
        <div>TARGET: <span id="target">20</span></div>
        <div class="runs-box"><span id="runs">0</span> / <span id="wickets" class="wicket-box">0</span></div>
    </div>

    <div class="field">
        <div class="ball" id="ball">‚öæ</div>
        <div class="batter" id="player">üèè</div>
        <div id="message" style="position:absolute; top:10px; font-weight:bold; color:white; text-shadow:1px 1px 3px black; font-size:1.5em; display:none;">SIX!</div>
    </div>

    <div class="commentary-box">
        <div class="commentary-text" id="commentary">The bowler is running in...</div>
        <div class="question-text" id="q-text">Loading match data...</div>
        <div class="options-grid" id="options-box"></div>
    </div>
</div>

<script>
    let runs = 0;
    let wickets = 0;
    const TARGET = 20;
    const MAX_WICKETS = 3;

    // Different physics "bowlers" (topics)
    const commentaryLines = [
        "It's a tricky Physics question about Gravity!",
        "Here comes a fast ball about Velocity!",
        "A spinning question on Thermodynamics!",
        "Can you solve this Optics bouncer?"
    ];

    async function loadBall() {
        const qText = document.getElementById("q-text");
        const optBox = document.getElementById("options-box");
        const comm = document.getElementById("commentary");
        const msg = document.getElementById("message");
        
        // Reset UI
        msg.style.display = 'none';
        document.getElementById("player").classList.remove("anim-out");
        optBox.innerHTML = "";
        
        // Random "Bowler" commentary
        comm.innerText = commentaryLines[Math.floor(Math.random() * commentaryLines.length)];

        try {
            // Using your robust backend
            const res = await fetch(`/api/ai/get_question?subject=Physics&difficulty=Medium`);
            const data = await res.json();

            qText.innerText = data.question;
            
            data.options.forEach((opt, index) => {
                const btn = document.createElement("button");
                btn.className = "btn";
                btn.innerText = opt;
                btn.onclick = () => playShot(index, data.answer, btn);
                optBox.appendChild(btn);
            });
        } catch(e) {
            qText.innerText = "Match rained out (Connection Error).";
        }
    }

    function playShot(selected, correct, btn) {
        const player = document.getElementById("player");
        const ball = document.getElementById("ball");
        const msg = document.getElementById("message");
        
        // Disable buttons
        document.querySelectorAll(".btn").forEach(b => b.disabled = true);

        if (selected === correct) {
            // HIT A 4 or 6 (Randomly)
            const shotVal = Math.random() > 0.5 ? 6 : 4;
            runs += shotVal;
            
            btn.classList.add("four"); // Green Button
            msg.innerText = shotVal + " RUNS!";
            msg.style.color = shotVal === 6 ? "#fdd835" : "#fff";
            msg.style.display = "block";
            
            // Animation
            ball.className = "ball anim-six"; 
            setTimeout(() => ball.className = "ball", 800);

        } else {
            // WICKET
            wickets++;
            btn.classList.add("out"); // Red Button
            msg.innerText = "OUT!";
            msg.style.color = "#ff5252";
            msg.style.display = "block";
            
            // Animation
            player.classList.add("anim-out");
        }

        updateScore();
        checkGameStatus();
    }

    function updateScore() {
        document.getElementById("runs").innerText = runs;
        document.getElementById("wickets").innerText = wickets;
    }

    function checkGameStatus() {
        setTimeout(() => {
            if (runs >= TARGET) {
                alert("MATCH WON! üèÜ You chased the target!");
                location.reload();
            } else if (wickets >= MAX_WICKETS) {
                alert("ALL OUT! ‚ùå You lost the match.");
                location.reload();
            } else {
                loadBall();
            }
        }, 1500);
    }

    loadBall();
</script>
</body>
</html>